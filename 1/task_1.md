# Задача #1: Реализация алгоритма парсинга и сортировки больших данных

## Условие

У вас есть большой файл размером несколько гигабайт, содержащий информацию о транзакциях в текстовом формате. Каждая строка файла представляет одну транзакцию и имеет следующий формат:

```
<timestamp>,<transaction_id>,<user_id>,<amount>
```

**Пример строки:**

```
2023-09-03T12:45:00Z,txn12345,user987,500.25
```

## Задание

Реализуйте программу на Ruby, которая выполняет следующие действия:

1. Читает файл с диска, не загружая его полностью в память.
2. Парсит каждую строку и представляет транзакции в виде объектов.
3. Сортирует транзакции по `amount` в порядке убывания.
4. Записывает отсортированные транзакции в новый файл, также не загружая все данные в память одновременно.

## Требования

- Вы должны использовать методы обработки данных, которые эффективны по использованию памяти и времени выполнения.
- Предполагается, что объём данных может не помещаться в оперативной памяти, поэтому использование стримов и ленивой загрузки будет предпочтительным.
- Реализуйте свою версию алгоритма сортировки, а не используйте встроенные методы Ruby для сортировки (например, `sort`).
- Напишите тесты для вашего кода (RSpec как плюс).

## Решение

Для решения задачи мы можем реализовать программу, которая будет:

- Читать файл построчно.
- Парсить данные в объекты.
- Сортировать их с помощью собственного алгоритма сортировки.

### Реализация программы

```
main.rb
transaction.rb
transaction_parser.rb
transaction_sorter.rb
transaction_processor.rb

transactions.txt
sorted_transactions.txt
```

## Примечания

- Данный код реализует простую систему для парсинга и сортировки больших файлов с транзакциями.
- Используется алгоритм быстрой сортировки, но можно использовать и другие подходы в зависимости от задачи.
- Алгоритм должен быть запущен в окружении, где доступны методы работы с файлами. Данная программа учитывает потенциальные ограничения потока и памяти. 

## Проверка работоспособности

Чтобы проверить работоспособность предложенной системы, вы можете создать пример файла с транзакциями и запустить скрипт для их сортировки.

### 1. Создание примера файла

Создайте файл `transactions.txt` с содержимым:

```
2023-09-03T12:45:00Z,txn12345,user987,500.25
2023-09-03T12:46:00Z,txn12346,user988,750.00
2023-09-03T12:47:00Z,txn12347,user989,250.75
2023-09-03T12:48:00Z,txn12348,user990,1000.50
2023-09-03T12:49:00Z,txn12349,user991,10.00
2023-09-03T12:50:00Z,txn12350,user992,300.00
2023-09-03T12:51:00Z,txn12351,user993,800.00
2023-09-03T12:52:00Z,txn12352,user994,600.20
2023-09-03T12:53:00Z,txn12353,user995,1500.00
2023-09-03T12:54:00Z,txn12354,user996,50.40
```

### 2. Запуск программы

Перейдите в папку  `parsing_and_sorting` и выполните `ruby main.rb`.

Вывод программы:

```bash
➜  parsing_and_sorting ruby main.rb                  
Парсинг завершен! Обработано 10 транзакций.
Сортировка завершена! Транзакции отсортированы по сумме.
Результаты записаны в файл 'sorted_transactions.txt'.
```

### 3. Проверка результата

После выполнения программы должен быть создан файл `sorted_transactions.txt`. Откройте его и проверьте правильность сортировки.

### Пример содержимого `sorted_transactions.txt`

```
2023-09-03T12:53:00Z,txn12353,user995,1500.00
2023-09-03T12:48:00Z,txn12348,user990,1000.50
2023-09-03T12:46:00Z,txn12346,user988,750.00
2023-09-03T12:51:00Z,txn12351,user993,800.00
2023-09-03T12:52:00Z,txn12352,user994,600.20
2023-09-03T12:50:00Z,txn12350,user992,300.00
2023-09-03T12:45:00Z,txn12345,user987,500.25
2023-09-03T12:47:00Z,txn12347,user989,250.75
2023-09-03T12:54:00Z,txn12354,user996,50.40
2023-09-03T12:49:00Z,txn12349,user991,10.00
```

### 4. Проверка корректности

Проверьте, что все строки в `sorted_transactions.txt` отсортированы по убыванию значений `amount`. Убедитесь в корректности работы программы и соответствии результата вашим ожиданиям!

## Тестирование с использованием RSpec

Тесты для парсинга и сортировки находятся в папке `spec`.

```
transaction_spec.rb
```

### Запуск тестов

Убедитесь, что у вас установлен RSpec:

```bash
gem install rspec
```

Запустите тесты:

```bash
rspec spec/transaction_spec.rb
```

Вывод тестов:

```bash
➜  parsing_and_sorting rspec spec/transaction_spec.rb

...

Finished in 0.05281 seconds (files took 1.16 seconds to load)
3 examples, 0 failures
```